<div style="display: flex; align-items: center; gap: 8px;">
  <button id="toggleBtn" onclick="toggleTimer()" style="background: none; border: none; font-size: 20px; cursor: pointer;">▶️</button>
  <span id="timerText" style="font-size: 14px; font-family: sans-serif;">00:00:00</span>
</div>

<script>
  let startTime, elapsedTime = 0, timerInterval, isRunning = false;

  const taskId = dynamicVars['fluxo_de_trabalho_id']; // <- VARIÁVEL DINÂMICA DO WEWEB
  const API_URL = `https://x8ki-letl-twmt.n7.xano.io/api:MmzSqGu8/fluxo_de_trabalho/${taskId}`;

  function formatTime(ms) {
    const total = Math.floor(ms / 1000);
    const h = String(Math.floor(total / 3600)).padStart(2, '0');
    const m = String(Math.floor((total % 3600) / 60)).padStart(2, '0');
    const s = String(total % 60).padStart(2, '0');
    return `${h}:${m}:${s}`;
  }

  function updateDisplay() {
    const now = Date.now();
    const diff = now - startTime + elapsedTime;
    document.getElementById("timerText").textContent = formatTime(diff);
  }

  async function toggleTimer() {
    const btn = document.getElementById("toggleBtn");

    if (!isRunning) {
      // INICIAR
      startTime = Date.now();
      timerInterval = setInterval(updateDisplay, 1000);
      isRunning = true;
      btn.textContent = "⏸️";

      await fetch(API_URL, {
        method: "PATCH",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          Last_Started_At: new Date().toISOString(),
          Timer_Running: true
        })
      });

    } else {
      // PAUSAR
      clearInterval(timerInterval);
      isRunning = false;
      btn.textContent = "▶️";

      const now = Date.now();
      const diff = now - startTime;
      elapsedTime += diff;

      const totalSeconds = Math.floor(elapsedTime / 1000);
      await fetch(API_URL, {
        method: "PATCH",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          Tempo_Total: totalSeconds,
          Timer_Running: false
        })
      });
    }
  }
</script>

